# MVP技術方針書

**作成日**: 2026年2月24日
**状態**: 方針決定済み・開発準備フェーズ

## 前提

- 既存の技術調査・市場調査は完了済み（本リポジトリの各資料を参照）
- 本ドキュメントは調査結果を踏まえた上での **MVP開発の技術方針** をまとめたもの
- MVPは最小機能・低コストでリリース可能なものを目指す

## プロダクト概要

**対話型エンディングノート**

- ユーザーがAIボットと音声で自然に会話する
- 会話の内容からエンディングノートの質問項目を自動で整理・記録する
- 「会話するだけでエンディングノートが完成する」体験を提供する

## ターゲットプラットフォーム

### 決定：モバイルファーストのWebアプリ（PWA）

| 候補 | 判定 | 理由 |
|------|------|------|
| **モバイルWeb（PWA）** | **採用** | 低コスト・URL共有だけで配布可能・審査不要 |
| ネイティブアプリ | 不採用 | iOS/Android別開発が必要・ストア審査に時間がかかる |
| ラズパイ専用機 | 不採用 | ハード調達/配送コスト・ソフト更新が困難 |
| デスクトップWeb | 対応するが優先度低 | ターゲット層のPC利用率が低い |

### 理由

- ターゲットユーザー（60〜80代）はスマホを所持している前提（家族が持たせている）
- 「自宅でリラックスしながら電話感覚で話す」利用シーンにスマホが最適
- 家族がURLを送るだけで利用開始できる手軽さ
- レスポンシブ対応でタブレット・PCにも自然に展開可能

### 対応優先度

```
1位: モバイルWeb（スマホブラウザ）  ← メインターゲット
2位: タブレットWeb                 ← レスポンシブで自然対応
3位: デスクトップWeb               ← 対応はするが最適化は後回し
```

## 技術スタック

### 決定：React + Vite + 軽量バックエンド

既存の調査資料ではNext.js + Firebaseが推奨されていたが、MVP特性を再評価した結果、よりシンプルな構成を採用する。

### フロントエンド

| 技術 | バージョン | 用途 |
|------|-----------|------|
| React | 19 | UIフレームワーク |
| Vite | 6+ | ビルドツール・開発サーバー |
| TypeScript | 5+ | 型安全性 |
| Tailwind CSS | 4 | スタイリング |

### バックエンド（WebSocketリレーサーバー）

| 技術 | 用途 |
|------|------|
| Hono | 軽量Webフレームワーク（WebSocketリレー） |
| Node.js | ランタイム |

### インフラ・サービス

| 技術 | 用途 |
|------|------|
| Firebase Auth | 認証（Google認証） |
| Firestore | データ保存 |
| Firebase Hosting | フロントエンドホスティング |
| OpenAI Realtime API | 音声AI（WebSocket接続） |

### システム構成図

```
┌──────────────┐     WebSocket      ┌──────────────┐     WebSocket     ┌──────────────────┐
│              │ ←────────────────→ │              │ ←───────────────→ │                  │
│  クライアント  │                    │  Honoサーバー  │                   │ OpenAI Realtime  │
│  (React SPA) │                    │              │                   │      API         │
│              │                    │  - APIキー保護 │                   │                  │
└──────┬───────┘                    │  - セッション管理│                   └──────────────────┘
       │                           │  - 会話ログ保存 │
       │  Firebase SDK             └──────────────┘
       │
       ▼
┌──────────────┐
│   Firebase   │
│  - Auth      │
│  - Firestore │
│  - Hosting   │
└──────────────┘
```

### Next.jsを不採用とした理由

1. **SSRが不要** — ログイン後に使うプライベートアプリでSEO不要
2. **WebSocketとの相性** — Next.js API Routes（Vercel）はWebSocketを直接サポートしない。結局別途サーバーが必要になる
3. **App Routerの複雑さ** — MVPでは速度を優先すべき。過剰な抽象化を避ける
4. **既存Kinoteとは独立** — 既存システムの技術的制約に縛られる必要がない

### この構成の利点

- **シンプル** — Viteはビルドが速く設定が少ない
- **WebSocket自由** — バックエンドが独立しているので制約なし
- **Firebase連携** — クライアントSDKで直接接続。追加設定不要
- **PWA対応** — vite-plugin-pwaで追加可能
- **デプロイ先の柔軟性** — HonoはCloudflare Workers / Node.js / Deno対こでも動作

## MVPスコープ方針

### スコープ判断の基準

このMVPで検証すべき仮説は以下の3つである。スコープの線引きはすべてこの仮説に基づく。

| # | 検証仮説 | 判定基準 |
|---|---------|---------|
| 1 | 高齢者（60〜80代）がAI音声ボットと自然に会話できるか | 初回セッション完走率 > 70% |
| 2 | 会話を通じてエンディングノートの内容を引き出せるか | 1セッションあたり有効項目抽出数 >= 3 |
| 3 | 継続して使いたいと思えるか | 2回目以降のセッション開始率 > 40% |

**原則：上記3仮説の検証に直結する部分は作り込む。それ以外は最小限にする。**

### 作り込む領域（検証仮説に直結）

これらが不十分だと、MVPで検証したいこと自体が検証できなくなる。

#### 音声会話体験（仮説1・2に直結）

- 会話の開始・終了が直感的であること
- AIの応答待ちの間、ユーザーが不安にならないフィードバック
- マイク権限取得のわかりやすい案内
- 通信エラー・音声認識失敗時のリカバリフロー

#### アクセシビリティ・操作性（仮説1に直結）

- 文字サイズ: 最小`text-lg`(18px)、推奨`text-xl`(20px)以上
- タッチターゲット: 最小44px（`min-h-11 min-w-11`）
- 色コントラスト: WCAG AA基準（4.5:1）以上
- ボタン・操作要素は画面内に収まり、スクロール不要
- 状態変化は視覚＋テキストの両方で伝える（色だけに頼らない）

#### エラーハンドリングのUX（仮説1・3に直結）

- すべてのエラーメッセージはやさしい日本語で表示
- 技術的な用語は一切表示しない
- 「何をすればよいか」の次のアクションを必ず提示
- 例: 「接続が切れてしまいました。もう一度ボタンを押してください」

#### みどりさんのキャラクター性（仮説2・3に直結）

- 初回会話での自己紹介と信頼関係構築
- 敬語ベースだが堅すぎない、親しみやすい口調
- エンディングノートの話題への自然な誘導
- ユーザーの発話への共感・傾聴の表現

### 最小限にする領域（検証仮説に直結しない）

| 領域 | MVPでの扱い | 理由 |
|-----|------------|------|
| 機能の幅 | エンディングノートの全項目を網羅しない。1〜2テーマ（例: 家族へのメッセージ、医療方針）に絞る | テーマ数より会話品質が重要 |
| アカウント管理 | Googleログインのみ。プロフィール編集なし | 認証は検証に必要だが、管理機能は不要 |
| 会話履歴 | 直近の会話結果を一覧表示できれば十分。検索・フィルタ・編集は不要 | 継続利用の判定に最低限の履歴は必要 |
| 管理画面 | 作らない。運用はFirebaseコンソールで直接対応 | ユーザー向け機能ではない |
| デザインの装飾 | 見やすさ・わかりやすさ優先。凝ったアニメーション・グラデーション不要 | 視覚的洗練より操作の明快さ |
| ブラウザ対応 | Chrome + Safari（iOS）のみ。Firefox・Edgeは対象外 | ターゲット層の利用ブラウザに集中 |
| 多言語対応 | 日本語のみ | ターゲット市場が日本 |
| 家族共有・PDF出力 | 非搭載 | 会話体験の検証とは独立 |
| 詳細な設定画面 | 非搭載。音声速度等の調整はMVP後 | 初期はデフォルト値で検証 |

### MVP機能一覧

| 機能 | 優先度 | 作り込み度 |
|-----|--------|----------|
| Googleログイン | 必須 | 最小限（Firebase Authそのまま） |
| AIとの音声会話 | 必須 | **作り込む** |
| 会話中のリアルタイムフィードバック | 必須 | **作り込む** |
| エラー時のやさしい日本語案内 | 必須 | **作り込む** |
| みどりさんのキャラクター設定 | 必須 | **作り込む** |
| 会話内容からの項目抽出 | 必須 | 中程度（精度はMVP後に改善） |
| 抽出結果の表示・確認 | 必須 | 最小限（一覧表示のみ） |
| 会話履歴の一覧表示 | 任意 | 最小限 |

## iOS Safari対応の注意点

ターゲット層にiPhoneユーザーが多いため、MVP段階から対応必須。

- AudioContextはユーザー操作（タップ）後にのみ起動可能
- MediaRecorderの挙動がAndroid/PCと異なる
- webkit prefixの対応が必要な場合あり
- 開発初期からiOS実機での動作検証を行う

## 既存Kinoteとの関係

- MVPは **既存Kinoteとは別アプリ** として開発する
- 既存システムに影響を与えずに実験・検証が可能
- MVP検証後に統合するかどうかを判断する
- Firebase環境は既存と共有 or 別プロジェクトとするかは開発開始時に決定

## 参考資料

| ファイル | 内容 |
|---------|------|
| `CONVERSATIONAL_AI_RESEARCH_SUMMARY.md` | 技術・市場調査の統合レポート |
| `REALTIME_API_MVP_PLAN.md` | 当初のMVP実装計画（Next.js前提） |
| `REALTIME_UX_DESIGN.md` | 高齢者向け音声対話UX設計 |
| `REALTIME_SYSTEM_INTEGRATION.md` | 既存Kinoteとの統合設計 |
